<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eraaj-Data</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<style>
:root{--primary:#1a73e8;--primary-dark:#1557b0;--secondary:#00c853;--bg:#f0f4ff;--card-bg:#ffffff;--text:#1a1a2e;--text-light:#666;--border:#e0e0e0;--danger:#e53935;--nav-bg:#ffffff;--input-bg:#f5f5f5;--shadow:0 4px 20px rgba(0,0,0,0.08);--radius:16px}
body.dark-mode{--bg:#0d0d1a;--card-bg:#1a1a2e;--text:#f0f0f0;--text-light:#aaa;--border:#2a2a3e;--nav-bg:#1a1a2e;--input-bg:#0d0d1a;--shadow:0 4px 20px rgba(0,0,0,0.4)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:all 0.3s ease}
.screen{width:100%;min-height:100vh}.screen
/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}

/* SPLASH */
#splashScreen{display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(135deg,#1a73e8,#0d47a1);color:#fff}
.splash-logo{width:100px;height:100px;background:rgba(255,255,255,0.2);border-radius:28px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:900;margin-bottom:20px;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.splash-title{font-size:28px;font-weight:700;margin-bottom:8px}
.splash-sub{opacity:0.7;font-size:15px;margin-bottom:40px}
.splash-spinner{width:36px;height:36px;border:3px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.8s linear infinite}

/* AUTH */
.auth-container{max-width:420px;margin:0 auto;padding:40px 24px 24px}
.logo-area{text-align:center;margin-bottom:32px}
.logo-circle{width:80px;height:80px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;font-weight:bold;color:#fff;margin:0 auto 16px;box-shadow:0 8px 32px rgba(26,115,232,0.3)}
.logo-area h1{font-size:26px;color:var(--primary);margin-bottom:4px}.logo-area p{color:var(--text-light);font-size:14px}
.auth-tabs{display:flex;background:var(--input-bg);border-radius:12px;padding:4px;margin-bottom:24px}
.tab-btn{flex:1;padding:10px;border:none;background:transparent;border-radius:10px;cursor:pointer;font-size:15px;color:var(--text-light);transition:all 0.3s}
.tab-btn.active{background:var(--primary);color:#fff;font-weight:600}
.auth-form.hidden{display:none}
.input-group{display:flex;align-items:center;background:var(--input-bg);border:1.5px solid var(--border);border-radius:12px;padding:0 14px;margin-bottom:14px;transition:border 0.3s}
.input-group:focus-within{border-color:var(--primary)}
.input-group i{color:var(--primary);width:20px;margin-right:10px}
.input-group input,.input-group select{flex:1;border:none;background:transparent;padding:14px 0;font-size:15px;color:var(--text);outline:none}
.input-group select option{background:var(--card-bg);color:var(--text)}
.toggle-pw{cursor:pointer;color:var(--text-light)!important}
.btn-primary{width:100%;padding:16px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;margin-top:8px;transition:transform 0.2s,opacity 0.2s;box-shadow:0 4px 16px rgba(26,115,232,0.3)}
.btn-primary:active{transform:scale(0.98);opacity:0.9}
.btn-primary:disabled{opacity:0.6;cursor:not-allowed}
.forgot{text-align:center;color:var(--primary);margin-top:12px;cursor:pointer;font-size:14px}
.auth-error{background:rgba(229,57,53,0.1);border:1px solid rgba(229,57,53,0.3);color:var(--danger);border-radius:10px;padding:10px 14px;font-size:13px;margin-bottom:12px;display:none}
.auth-error.show{display:block}

/* MAIN APP */
#mainApp{display:flex;flex-direction:column;min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:var(--card-bg);box-shadow:var(--shadow);position:sticky;top:0;z-index:100}
.topbar-left{display:flex;align-items:center;gap:12px}
.avatar{width:44px;height:44px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:bold;font-size:18px}
.greeting{font-weight:600;font-size:16px}.user-id{font-size:12px;color:var(--text-light)}
.topbar-right{display:flex;gap:8px}
.icon-btn{width:38px;height:38px;border:1.5px solid var(--border);background:var(--input-bg);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text);font-size:15px}
.pages{flex:1;overflow-y:auto;padding-bottom:80px}
.page{padding:20px}.page
/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}

/* BALANCE CARD */
.balance-card{background:linear-gradient(135deg,#1a73e8,#0d47a1);border-radius:var(--radius);padding:24px;color:#fff;margin-bottom:24px;box-shadow:0 8px 32px rgba(26,115,232,0.4);position:relative;overflow:hidden}
.balance-card::after{content:'';position:absolute;top:-40px;right:-40px;width:160px;height:160px;background:rgba(255,255,255,0.05);border-radius:50%}
.balance-top{display:flex;justify-content:space-between;align-items:flex-start}
.balance-label{font-size:13px;opacity:0.8;margin-bottom:4px}
.balance-amount{font-size:32px;font-weight:700}
.badge-null{background:rgba(0,200,83,0.2);border:1px solid rgba(0,200,83,0.5);color:#00e676;font-size:11px;padding:4px 10px;border-radius:20px;font-weight:600}
.balance-bottom{margin:8px 0;font-size:13px;opacity:0.75}
.balance-actions{display:flex;gap:12px;margin-top:16px}
.btn-fund,.btn-referral{flex:1;padding:10px;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:transform 0.2s}
.btn-fund{background:#fff;color:var(--primary)}.btn-referral{background:rgba(255,255,255,0.15);color:#fff;border:1px solid rgba(255,255,255,0.3)}
.btn-fund:active,.btn-referral:active{transform:scale(0.97)}
.section-title{font-size:16px;font-weight:700;margin-bottom:14px;color:var(--text);display:flex;justify-content:space-between;align-items:center}
.see-all{font-size:13px;color:var(--primary);cursor:pointer;font-weight:500}
.quick-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:28px}
.action-btn{display:flex;flex-direction:column;align-items:center;gap:8px;cursor:pointer}
.action-btn span{font-size:12px;color:var(--text);font-weight:500}
.action-icon{width:56px;height:56px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:22px;color:#fff;transition:transform 0.2s}
.action-btn:active .action-icon{transform:scale(0.92)}
.data-icon{background:linear-gradient(135deg,#1a73e8,#0d47a1)}
.airtime-icon{background:linear-gradient(135deg,#e53935,#b71c1c)}
.elec-icon{background:linear-gradient(135deg,#f9a825,#e65100)}
.cable-icon{background:linear-gradient(135deg,#6a1b9a,#4a148c)}

/* TRANSACTIONS */
.tx-list{display:flex;flex-direction:column;gap:10px}
.tx-empty{text-align:center;color:var(--text-light);padding:40px 0;font-size:14px}
.tx-item{background:var(--card-bg);border-radius:12px;padding:14px 16px;display:flex;align-items:center;gap:14px;box-shadow:var(--shadow);border:1px solid var(--border)}
.tx-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;color:#fff;flex-shrink:0}
.tx-icon.data{background:linear-gradient(135deg,#1a73e8,#0d47a1)}
.tx-icon.airtime{background:linear-gradient(135deg,#e53935,#b71c1c)}
.tx-icon.electricity{background:linear-gradient(135deg,#f9a825,#e65100)}
.tx-icon.fund{background:linear-gradient(135deg,#00c853,#1b5e20)}
.tx-icon.cable{background:linear-gradient(135deg,#6a1b9a,#4a148c)}
.tx-details{flex:1}.tx-title{font-weight:600;font-size:14px}.tx-sub{font-size:12px;color:var(--text-light);margin-top:2px}
.tx-right{text-align:right}.tx-amount{font-weight:700;font-size:15px}
.tx-amount.debit{color:var(--danger)}.tx-amount.credit{color:var(--secondary)}
.tx-date{font-size:11px;color:var(--text-light);margin-top:2px}
.tx-badge{font-size:10px;padding:2px 8px;border-radius:20px;margin-top:4px;display:inline-block}
.tx-badge.success{background:rgba(0,200,83,0.15);color:var(--secondary)}
.tx-badge.pending{background:rgba(249,168,37,0.15);color:#f9a825}
.tx-badge.failed{background:rgba(229,57,53,0.15);color:var(--danger)}

/* PAGES */
.page-header{margin-bottom:20px}.page-header h2{font-size:22px;font-weight:700}
.filter-row{display:flex;gap:8px;margin-top:12px;overflow-x:auto;padding-bottom:4px}
.filter-btn{padding:6px 16px;border-radius:20px;border:1.5px solid var(--border);background:transparent;color:var(--text-light);cursor:pointer;white-space:nowrap;font-size:13px;transition:all 0.2s}
.filter-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}
.wallet-balance-card{background:linear-gradient(135deg,#00c853,#1b5e20);border-radius:var(--radius);padding:28px;color:#fff;text-align:center;margin-bottom:20px}
.wallet-balance-card p{opacity:0.8;margin-bottom:8px}.wallet-balance-card h2{font-size:36px;font-weight:700}
.wallet-options{display:flex;gap:12px;margin-bottom:24px}
.wallet-option{flex:1;background:var(--card-bg);border-radius:12px;padding:20px;text-align:center;cursor:pointer;box-shadow:var(--shadow);border:1px solid var(--border);transition:transform 0.2s}
.wallet-option:active{transform:scale(0.97)}
.wallet-option i{font-size:24px;color:var(--primary);display:block;margin-bottom:8px}
.wallet-option span{font-size:14px;font-weight:500}
.profile-card{background:var(--card-bg);border-radius:var(--radius);padding:28px;text-align:center;margin-bottom:20px;box-shadow:var(--shadow)}
.profile-avatar{width:80px;height:80px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;margin:0 auto 12px;display:flex;align-items:center;justify-content:center;font-size:32px;color:#fff;font-weight:bold}
.profile-card h3{font-size:20px;font-weight:700}.profile-card p{color:var(--text-light);font-size:14px;margin-top:4px}
.profile-id{font-size:13px;margin-top:8px}
.profile-menu{display:flex;flex-direction:column;gap:2px}
.menu-item{display:flex;align-items:center;gap:14px;padding:16px;background:var(--card-bg);border-radius:12px;cursor:pointer;font-size:15px;border:1px solid var(--border);transition:background 0.2s}
.menu-item:active{background:var(--input-bg)}.menu-item i{color:var(--primary);width:20px}
.right-icon{margin-left:auto;color:var(--text-light)}
.menu-item.danger{color:var(--danger)}.menu-item.danger i{color:var(--danger)}
.referral-box{background:var(--card-bg);border-radius:var(--radius);padding:20px;margin-top:16px;border:2px dashed var(--primary)}
.referral-box h3{margin-bottom:10px}.referral-box p{font-size:14px;color:var(--text-light);margin-bottom:16px}
.ref-code-box{display:flex;align-items:center;gap:10px;background:var(--input-bg);padding:12px 16px;border-radius:10px;margin-bottom:12px}
.ref-code-box span{font-size:20px;font-weight:700;letter-spacing:3px;flex:1}
.ref-code-box button{padding:8px 14px;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:13px}
.ref-stats{font-size:14px;color:var(--text-light)}

/* NAV */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:var(--nav-bg);border-top:1px solid var(--border);box-shadow:0 -4px 20px rgba(0,0,0,0.08);z-index:200}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;padding:10px 0;border:none;background:transparent;color:var(--text-light);cursor:pointer;font-size:11px;gap:4px;transition:color 0.2s}
.nav-btn i{font-size:20px}.nav-btn.active{color:var(--primary)}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:flex-end;z-index:500;backdrop-filter:blur(4px)}
.modal-overlay
/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}
.modal{background:var(--card-bg);border-radius:24px 24px 0 0;padding:24px;width:100%;max-height:90vh;overflow-y:auto;animation:slideUp 0.3s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.modal-header h3{font-size:20px;font-weight:700}
.close-modal{width:32px;height:32px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:16px;color:var(--text)}
.modal-note{font-size:13px;color:var(--text-light);margin-bottom:16px}
.amount-shortcuts{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.amount-shortcuts button{padding:8px 14px;background:var(--input-bg);border:1.5px solid var(--border);border-radius:8px;cursor:pointer;font-size:13px;color:var(--primary);font-weight:600}
.amount-shortcuts button:active{background:var(--primary);color:#fff}
.price-box{background:rgba(0,200,83,0.1);border:1px solid rgba(0,200,83,0.3);border-radius:10px;padding:12px 16px;margin-bottom:16px;font-size:15px}
.price-box
/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}
.pin-inputs{display:flex;gap:12px;justify-content:center;margin:20px 0}
.pin-box{width:56px;height:56px;border:2px solid var(--border);border-radius:12px;text-align:center;font-size:24px;background:var(--input-bg);color:var(--text);outline:none}
.pin-box:focus{border-color:var(--primary)}
.success-modal{text-align:center;border-radius:24px!important;margin:auto;width:calc(100% - 40px);max-width:320px}
.success-icon{font-size:60px;margin-bottom:16px}
.success-modal h3{font-size:22px;margin-bottom:8px}.success-modal p{color:var(--text-light);margin-bottom:20px;white-space:pre-line}

/* TOAST */
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:24px;font-size:14px;z-index:1000;box-shadow:0 4px 20px rgba(0,0,0,0.3);white-space:nowrap;max-width:90vw;overflow:hidden;text-overflow:ellipsis}
.toast
/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}.toast.success{background:var(--secondary)}.toast.error{background:var(--danger)}
.loading-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:999;flex-direction:column;gap:16px}
.loading-overlay p{color:#fff;font-size:14px}
.spinner{width:48px;height:48px;border:4px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.firebase-badge{display:inline-flex;align-items:center;gap:4px;background:rgba(255,152,0,0.15);border:1px solid rgba(255,152,0,0.4);color:#ff9800;font-size:11px;padding:3px 8px;border-radius:20px;margin-left:8px}

/* ===== NOTICE BANNER ===== */
.notice-banner{margin-bottom:20px}
.notice-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;margin-bottom:8px;border-radius:14px;border-left:4px solid;background:var(--card-bg);box-shadow:var(--shadow);position:relative;animation:slideDown 0.4s ease}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
.notice-item.info{border-color:#1a73e8;background:rgba(26,115,232,0.06)}
.notice-item.warning{border-color:#f9a825;background:rgba(249,168,37,0.06)}
.notice-item.success{border-color:#00c853;background:rgba(0,200,83,0.06)}
.notice-item.danger{border-color:#e53935;background:rgba(229,57,53,0.06)}
.notice-icon{font-size:20px;margin-top:2px;flex-shrink:0}
.notice-item.info .notice-icon{color:#1a73e8}
.notice-item.warning .notice-icon{color:#f9a825}
.notice-item.success .notice-icon{color:#00c853}
.notice-item.danger .notice-icon{color:#e53935}
.notice-content{flex:1}.notice-title{font-weight:700;font-size:14px;margin-bottom:3px}
.notice-msg{font-size:13px;color:var(--text-light);line-height:1.4}
.notice-time{font-size:11px;color:var(--text-light);margin-top:4px}
.notice-close{position:absolute;top:10px;right:10px;width:22px;height:22px;background:var(--input-bg);border:none;border-radius:50%;cursor:pointer;font-size:11px;color:var(--text-light)}
/* ===== ADMIN ===== */
.admin-panel{padding:20px}.admin-section{margin-bottom:24px}
.admin-section h3{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--primary)}
.admin-card{background:var(--card-bg);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);border:1px solid var(--border);margin-bottom:12px}
.notice-type-row{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:2px solid var(--border);background:transparent;cursor:pointer;font-size:13px;font-weight:600;color:var(--text)}
.type-btn.info.active{background:#1a73e8;color:#fff;border-color:#1a73e8}
.type-btn.warning.active{background:#f9a825;color:#fff;border-color:#f9a825}
.type-btn.success.active{background:#00c853;color:#fff;border-color:#00c853}
.type-btn.danger.active{background:#e53935;color:#fff;border-color:#e53935}
.admin-textarea{width:100%;padding:12px 14px;border:1.5px solid var(--border);border-radius:12px;background:var(--input-bg);color:var(--text);font-size:14px;resize:vertical;min-height:80px;outline:none;font-family:inherit;margin-bottom:4px}
.admin-textarea:focus{border-color:var(--primary)}
.admin-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat-card{background:var(--card-bg);border-radius:12px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid var(--border)}
.stat-number{font-size:22px;font-weight:700;color:var(--primary)}.stat-label{font-size:12px;color:var(--text-light);margin-top:4px}
.admin-lock{text-align:center;padding:60px 20px}
.admin-lock i{font-size:60px;color:var(--text-light);margin-bottom:16px;display:block}
.admin-lock h3{font-size:20px;margin-bottom:8px}.admin-lock p{color:var(--text-light);font-size:14px;margin-bottom:20px}
.existing-notice{display:flex;justify-content:space-between;align-items:flex-start;padding:12px;background:var(--input-bg);border-radius:10px;margin-bottom:8px}
.existing-notice-text{flex:1}
.existing-notice-badge{font-size:10px;padding:2px 8px;border-radius:10px;margin-bottom:4px;display:inline-block}
.existing-notice-badge.info{background:rgba(26,115,232,0.15);color:#1a73e8}
.existing-notice-badge.warning{background:rgba(249,168,37,0.15);color:#f9a825}
.existing-notice-badge.success{background:rgba(0,200,83,0.15);color:#00c853}
.existing-notice-badge.danger{background:rgba(229,57,53,0.15);color:#e53935}
.delete-notice-btn{background:rgba(229,57,53,0.1);border:none;color:#e53935;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:12px;flex-shrink:0;margin-left:8px}

.hidden{display:none!important}
</style>
</head>
<body class="light-mode">

<!-- SPLASH SCREEN -->
<div id="splashScreen" class="screen">
  <div class="splash-logo">ED</div>
  <div class="splash-title">Eraaj-Data</div>
  <div class="splash-sub">Fast ‚Ä¢ Cheap ‚Ä¢ Reliable</div>
  <div class="splash-spinner"></div>
</div>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="screen hidden">
  <div class="auth-container">
    <div class="logo-area">
      <div class="logo-circle">ED</div>
      <h1>Eraaj-Data</h1>
      <p>Fast ‚Ä¢ Cheap ‚Ä¢ Reliable <span class="firebase-badge">üî• Firebase</span></p>
    </div>
    <div class="auth-tabs">
      <button class="tab-btn active" onclick="showTab('login')">Login</button>
      <button class="tab-btn" onclick="showTab('register')">Register</button>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="auth-form">
      <div id="loginError" class="auth-error"></div>
      <div class="input-group">
        <i class="fa fa-envelope"></i>
        <input type="email" id="loginEmail" placeholder="Email address"/>
      </div>
      <div class="input-group">
        <i class="fa fa-lock"></i>
        <input type="password" id="loginPassword" placeholder="Password"/>
        <i class="fa fa-eye toggle-pw" onclick="togglePw('loginPassword')"></i>
      </div>
      <button class="btn-primary" id="loginBtn" onclick="loginUser()">
        <i class="fa fa-sign-in-alt"></i> Login
      </button>
      <p class="forgot" onclick="forgotPassword()">Forgot Password?</p>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="auth-form hidden">
      <div id="regError" class="auth-error"></div>
      <div class="input-group">
        <i class="fa fa-user"></i>
        <input type="text" id="regName" placeholder="Full name"/>
      </div>
      <div class="input-group">
        <i class="fa fa-phone"></i>
        <input type="tel" id="regPhone" placeholder="Phone number"/>
      </div>
      <div class="input-group">
        <i class="fa fa-envelope"></i>
        <input type="email" id="regEmail" placeholder="Email address"/>
      </div>
      <div class="input-group">
        <i class="fa fa-lock"></i>
        <input type="password" id="regPassword" placeholder="Password (min 6 chars)"/>
      </div>
      <div class="input-group">
        <i class="fa fa-gift"></i>
        <input type="text" id="regReferral" placeholder="Referral code (optional)"/>
      </div>
      <button class="btn-primary" id="regBtn" onclick="registerUser()">
        <i class="fa fa-user-plus"></i> Create Account
      </button>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp" class="screen hidden">
  <div class="topbar">
    <div class="topbar-left">
      <div class="avatar" id="userAvatar">E</div>
      <div>
        <p class="greeting">Hello, <span id="userName">User</span> üëã</p>
        <p class="user-id">ID: <span id="userId">--</span></p>
      </div>
    </div>
    <div class="topbar-right">
      <button class="icon-btn" onclick="toggleDarkMode()"><i class="fa fa-moon" id="darkIcon"></i></button>
      <button class="icon-btn" onclick="logout()"><i class="fa fa-sign-out-alt"></i></button>
    </div>
  </div>

  <div class="pages">
    <!-- HOME -->
    <div id="homePage" class="page">
      <div class="balance-card">
        <div class="balance-top">
          <div>
            <p class="balance-label">Wallet Balance</p>
            <h2 class="balance-amount">‚Ç¶<span id="balanceDisplay">0.00</span></h2>
          </div>
          <div class="badge-null">Null Charge ‚úì</div>
        </div>
        <div class="balance-bottom">Eraaj-Data ‚Äî <span id="acctName">User</span></div>
        <div class="balance-actions">
          <button class="btn-fund" onclick="showFundWallet()"><i class="fa fa-plus-circle"></i> Fund Wallet</button>
          <button class="btn-referral" onclick="showPage('profilePage');showReferral()"><i class="fa fa-users"></i> Referral</button>
        </div>
      </div>
      <div id="noticeBanner" class="notice-banner"></div>
      <div class="section-title">Quick Actions</div>
      <div class="quick-actions">
        <div class="action-btn" onclick="showService('data')">
          <div class="action-icon data-icon"><i class="fa fa-wifi"></i></div><span>Data</span>
        </div>
        <div class="action-btn" onclick="showService('airtime')">
          <div class="action-icon airtime-icon"><i class="fa fa-phone"></i></div><span>Airtime</span>
        </div>
        <div class="action-btn" onclick="showService('electricity')">
          <div class="action-icon elec-icon"><i class="fa fa-bolt"></i></div><span>Electricity</span>
        </div>
        <div class="action-btn" onclick="showService('cable')">
          <div class="action-icon cable-icon"><i class="fa fa-tv"></i></div><span>Cable TV</span>
        </div>
      </div>
      <div class="section-title">Recent Transactions <span class="see-all" onclick="showPage('transPage')">See All</span></div>
      <div id="recentTxList" class="tx-list"><div class="tx-empty">No transactions yet</div></div>
    </div>

    <!-- TRANSACTIONS -->
    <div id="transPage" class="page hidden">
      <div class="page-header">
        <h2>Transactions</h2>
        <div class="filter-row">
          <button class="filter-btn active" onclick="filterTx('all',this)">All</button>
          <button class="filter-btn" onclick="filterTx('data',this)">Data</button>
          <button class="filter-btn" onclick="filterTx('airtime',this)">Airtime</button>
          <button class="filter-btn" onclick="filterTx('electricity',this)">Electricity</button>
          <button class="filter-btn" onclick="filterTx('fund',this)">Funding</button>
        </div>
      </div>
      <div id="allTxList" class="tx-list"><div class="tx-empty">Loading...</div></div>
    </div>

    <!-- WALLET -->
    <div id="walletPage" class="page hidden">
      <div class="page-header"><h2>Wallet</h2></div>
      <div class="wallet-balance-card">
        <p>Available Balance</p>
        <h2>‚Ç¶<span id="walletBalDisplay">0.00</span></h2>
      </div>
      <div class="wallet-options">
        <div class="wallet-option" onclick="showFundWallet()">
          <i class="fa fa-plus-circle"></i><span>Fund Wallet</span>
        </div>
        <div class="wallet-option" onclick="showToast('Transfer coming soon!','success')">
          <i class="fa fa-paper-plane"></i><span>Transfer</span>
        </div>
      </div>
      <div class="section-title">Funding History</div>
      <div id="fundingHistory" class="tx-list"><div class="tx-empty">Loading...</div></div>
    </div>

    <!-- PROFILE -->
    <div id="profilePage" class="page hidden">
      <div class="page-header"><h2>Profile</h2></div>
      <div class="profile-card">
        <div class="profile-avatar" id="profileAvatar">E</div>
        <h3 id="profileName">User</h3>
        <p id="profileEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="12777f737b7e52776a737f627e773c717d7f">[email&#160;protected]</a></p>
        <p class="profile-id">ID: <span id="profileId">--</span></p>
      </div>
      <div class="profile-menu">
        <div class="menu-item" onclick="showReferral()">
          <i class="fa fa-users"></i> Referral Program <i class="fa fa-chevron-right right-icon"></i>
        </div>
        <div class="menu-item" onclick="showChangePin()">
          <i class="fa fa-key"></i> Change PIN <i class="fa fa-chevron-right right-icon"></i>
        </div>
        <div class="menu-item" onclick="toggleDarkMode()">
          <i class="fa fa-moon"></i> Dark Mode <i class="fa fa-toggle-on right-icon" id="darkToggleIcon"></i>
        </div>
        <div class="menu-item danger" onclick="logout()">
          <i class="fa fa-sign-out-alt"></i> Logout <i class="fa fa-chevron-right right-icon"></i>
        </div>
      </div>
      <div id="referralSection" class="referral-box hidden">
        <h3>üéÅ Referral Program</h3>
        <p>Share your code and earn <strong>‚Ç¶50</strong> for every friend who joins!</p>
        <div class="ref-code-box">
          <span id="myRefCode">--</span>
          <button onclick="copyRefCode()"><i class="fa fa-copy"></i> Copy</button>
        </div>
        <p class="ref-stats">Referrals: <strong id="refCount">0</strong> | Earned: <strong>‚Ç¶<span id="refEarned">0</span></strong></p>
      </div>
    </div>
  </div>


    <!-- ADMIN PAGE -->
    <div id="adminPage" class="page hidden">
      <div id="adminLock" class="admin-lock">
        <i class="fa fa-shield-alt"></i>
        <h3>Admin Access</h3>
        <p>Enter your admin password to continue</p>
        <div class="input-group" style="max-width:300px;margin:0 auto 12px">
          <i class="fa fa-lock"></i>
          <input type="password" id="adminPwInput" placeholder="Admin password"/>
        </div>
        <button class="btn-primary" style="max-width:300px;margin:0 auto" onclick="checkAdminPw()">Enter Admin Panel</button>
      </div>
      <div id="adminPanel" class="admin-panel hidden">
        <div class="page-header"><h2>‚öôÔ∏è Admin Panel</h2></div>
        <div class="admin-section">
          <h3>üìä Live Stats</h3>
          <div class="admin-stats">
            <div class="stat-card"><div class="stat-number" id="statUsers">--</div><div class="stat-label">System Status</div></div>
            <div class="stat-card"><div class="stat-number" id="statTx">--</div><div class="stat-label">Transactions</div></div>
            <div class="stat-card"><div class="stat-number" id="statNotices">--</div><div class="stat-label">Active Notices</div></div>
            <div class="stat-card"><div class="stat-number" id="statRevenue">--</div><div class="stat-label">Total Funded</div></div>
          </div>
        </div>
        <div class="admin-section">
          <h3>üì¢ Post Announcement</h3>
          <div class="admin-card">
            <p style="font-size:13px;color:var(--text-light);margin-bottom:12px">Choose notice type:</p>
            <div class="notice-type-row">
              <button class="type-btn info active" onclick="selectType('info',this)">‚ÑπÔ∏è Info</button>
              <button class="type-btn warning" onclick="selectType('warning',this)">‚ö†Ô∏è Warning</button>
              <button class="type-btn success" onclick="selectType('success',this)">‚úÖ Good News</button>
              <button class="type-btn danger" onclick="selectType('danger',this)">üö® Urgent</button>
            </div>
            <div class="input-group">
              <i class="fa fa-heading"></i>
              <input type="text" id="noticeTitle" placeholder="Title (e.g: MTN Network Issue)"/>
            </div>
            <textarea class="admin-textarea" id="noticeMsg" placeholder="Type your message here..."></textarea>
            <button class="btn-primary" onclick="postNotice()"><i class="fa fa-bullhorn"></i> Post to All Users</button>
          </div>
        </div>
        <div class="admin-section">
          <h3>üìã Active Notices</h3>
          <div id="adminNoticeList"><div class="tx-empty">No notices yet</div></div>
        </div>
      </div>
    </div>

  <nav class="bottom-nav">
    <button class="nav-btn active" onclick="showPage('homePage',this)"><i class="fa fa-home"></i><span>Home</span></button>
    <button class="nav-btn" onclick="showPage('transPage',this)"><i class="fa fa-list"></i><span>Transactions</span></button>
    <button class="nav-btn" onclick="showPage('walletPage',this)"><i class="fa fa-wallet"></i><span>Wallet</span></button>
    <button class="nav-btn" onclick="showPage('profilePage',this)"><i class="fa fa-user"></i><span>Profile</span></button>
    <button class="nav-btn" id="adminNavBtn" onclick="showPage('adminPage',this)" style="display:none"><i class="fa fa-shield-alt"></i><span>Admin</span></button>
  </nav>
</div>

<!-- MODALS -->
<div id="fundModal" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3>üí≥ Fund Wallet</h3>
      <button class="close-modal" onclick="closeModal('fundModal')">‚úï</button>
    </div>
    <p class="modal-note" id="fundModalNote">Powered by Paystack ‚Äî secure & instant</p>
    <div class="input-group">
      <i class="fa fa-money-bill"></i>
      <input type="number" id="fundAmount" placeholder="Enter amount (min ‚Ç¶100)" min="100"/>
    </div>
    <div class="amount-shortcuts">
      <button onclick="setAmount(500)">‚Ç¶500</button>
      <button onclick="setAmount(1000)">‚Ç¶1,000</button>
      <button onclick="setAmount(2000)">‚Ç¶2,000</button>
      <button onclick="setAmount(5000)">‚Ç¶5,000</button>
    </div>
    <button class="btn-primary" onclick="initiatePaystack()"><i class="fa fa-lock"></i> Pay Securely</button>
  </div>
</div>

<div id="dataModal" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3><i class="fa fa-wifi"></i> Buy Data</h3>
      <button class="close-modal" onclick="closeModal('dataModal')">‚úï</button>
    </div>
    <div class="input-group">
      <i class="fa fa-signal"></i>
      <select id="dataNetwork" onchange="populatePlans()">
        <option value="">-- Select Network --</option>
        <option value="MTN">MTN</option>
        <option value="Airtel">Airtel</option>
        <option value="Glo">Glo</option>
        <option value="9mobile">9mobile</option>
      </select>
    </div>
    <div class="input-group">
      <i class="fa fa-phone"></i>
      <input type="tel" id="dataPhone" placeholder="Phone number" maxlength="11"/>
    </div>
    <div class="input-group">
      <i class="fa fa-database"></i>
      <select id="dataPlan" onchange="updateDataPrice()">
        <option value="">-- Select Plan --</option>
      </select>
    </div>
    <div id="dataPriceBox" class="price-box hidden">Price: <strong id="dataPriceDisplay">‚Ç¶0</strong></div>
    <button class="btn-primary" onclick="buyData()">Buy Data</button>
  </div>
</div>

<div id="airtimeModal" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3><i class="fa fa-phone"></i> Buy Airtime</h3>
      <button class="close-modal" onclick="closeModal('airtimeModal')">‚úï</button>
    </div>
    <div class="input-group">
      <i class="fa fa-signal"></i>
      <select id="airtimeNetwork">
        <option value="">-- Select Network --</option>
        <option value="MTN">MTN</option>
        <option value="Airtel">Airtel</option>
        <option value="Glo">Glo</option>
        <option value="9mobile">9mobile</option>
      </select>
    </div>
    <div class="input-group">
      <i class="fa fa-phone"></i>
      <input type="tel" id="airtimePhone" placeholder="Phone number" maxlength="11"/>
    </div>
    <div class="input-group">
      <i class="fa fa-money-bill"></i>
      <input type="number" id="airtimeAmount" placeholder="Amount (min ‚Ç¶50)" min="50"/>
    </div>
    <div class="amount-shortcuts">
      <button onclick="setAirtimeAmt(100)">‚Ç¶100</button>
      <button onclick="setAirtimeAmt(200)">‚Ç¶200</button>
      <button onclick="setAirtimeAmt(500)">‚Ç¶500</button>
      <button onclick="setAirtimeAmt(1000)">‚Ç¶1,000</button>
    </div>
    <button class="btn-primary" onclick="buyAirtime()">Buy Airtime</button>
  </div>
</div>

<div id="electricityModal" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3><i class="fa fa-bolt"></i> Pay Electricity</h3>
      <button class="close-modal" onclick="closeModal('electricityModal')">‚úï</button>
    </div>
    <div class="input-group">
      <i class="fa fa-building"></i>
      <select id="elecDisco">
        <option value="">-- Select Disco --</option>
        <option value="IKEDC">Ikeja Electric (IKEDC)</option>
        <option value="EKEDC">Eko Electric (EKEDC)</option>
        <option value="AEDC">Abuja Electric (AEDC)</option>
        <option value="PHEDC">Port Harcourt Electric (PHEDC)</option>
        <option value="KAEDCO">Kaduna Electric (KAEDCO)</option>
        <option value="KEDCO">Kano Electric (KEDCO)</option>
      </select>
    </div>
    <div class="input-group">
      <i class="fa fa-hashtag"></i>
      <input type="text" id="meterNumber" placeholder="Meter number"/>
    </div>
    <div class="input-group">
      <i class="fa fa-toggle-on"></i>
      <select id="meterType">
        <option value="prepaid">Prepaid</option>
        <option value="postpaid">Postpaid</option>
      </select>
    </div>
    <div class="input-group">
      <i class="fa fa-money-bill"></i>
      <input type="number" id="elecAmount" placeholder="Amount (min ‚Ç¶500)" min="500"/>
    </div>
    <button class="btn-primary" onclick="payElectricity()">Pay Now</button>
  </div>
</div>

<div id="pinModal" class="modal-overlay hidden">
  <div class="modal">
    <div class="modal-header">
      <h3>üîê Enter PIN</h3>
      <button class="close-modal" onclick="closeModal('pinModal')">‚úï</button>
    </div>
    <p style="text-align:center;color:var(--text-light);margin-bottom:4px">Enter your 4-digit transaction PIN</p>
    <p style="text-align:center;font-size:12px;color:var(--primary);margin-bottom:8px">Default PIN: 0000</p>
    <div class="pin-inputs">
      <input type="password" class="pin-box" maxlength="1" oninput="pinNext(this,1)"/>
      <input type="password" class="pin-box" maxlength="1" oninput="pinNext(this,2)"/>
      <input type="password" class="pin-box" maxlength="1" oninput="pinNext(this,3)"/>
      <input type="password" class="pin-box" maxlength="1" oninput="pinNext(this,4)"/>
    </div>
    <button class="btn-primary" onclick="confirmPin()">Confirm</button>
  </div>
</div>

<div id="successModal" class="modal-overlay hidden" style="align-items:center;justify-content:center">
  <div class="modal success-modal">
    <div class="success-icon">‚úÖ</div>
    <h3 id="successTitle">Transaction Successful!</h3>
    <p id="successMsg">Your order has been processed.</p>
    <button class="btn-primary" onclick="closeModal('successModal')">Done</button>
  </div>
</div>

<div id="toast" class="toast hidden"></div>

<!-- FIREBASE SDK -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, orderBy, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

// ============================================
// üî• YOUR FIREBASE CONFIG ‚Äî REPLACE THIS!
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyDDwaptO2oLbj_bJHqJgIiYptbO1JcBtm0",
  authDomain: "eraaj-data.firebaseapp.com",
  projectId: "eraaj-data",
  storageBucket: "eraaj-data.firebasestorage.app",
  messagingSenderId: "946860800643",
  appId: "1:946860800643:web:d992d1e9c843b24a07f9b6"
};
// ============================================

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// CONFIG
const CONFIG = {
  paystackKey: "pk_test_YOUR_PAYSTACK_KEY",
  referralBonus: 50,
  minFund: 100,
  minAirtime: 50,
};

const DATA_PLANS = {
  MTN: [
    {id:"mtn_500mb",name:"500MB ‚Äì 30 Days",price:230,size:"500MB"},
    {id:"mtn_1gb",name:"1GB ‚Äì 30 Days",price:430,size:"1GB"},
    {id:"mtn_2gb",name:"2GB ‚Äì 30 Days",price:790,size:"2GB"},
    {id:"mtn_5gb",name:"5GB ‚Äì 30 Days",price:1900,size:"5GB"},
    {id:"mtn_10gb",name:"10GB ‚Äì 30 Days",price:3500,size:"10GB"}
  ],
  Airtel: [
    {id:"airt_1gb",name:"1GB ‚Äì 30 Days",price:400,size:"1GB"},
    {id:"airt_2gb",name:"2GB ‚Äì 30 Days",price:800,size:"2GB"},
    {id:"airt_5gb",name:"5GB ‚Äì 30 Days",price:1800,size:"5GB"}
  ],
  Glo: [
    {id:"glo_1gb",name:"1GB ‚Äì 30 Days",price:350,size:"1GB"},
    {id:"glo_2gb",name:"2GB ‚Äì 30 Days",price:700,size:"2GB"},
    {id:"glo_5gb",name:"5GB ‚Äì 30 Days",price:1700,size:"5GB"}
  ],
  "9mobile": [
    {id:"9mob_1gb",name:"1GB ‚Äì 30 Days",price:400,size:"1GB"},
    {id:"9mob_2gb",name:"2GB ‚Äì 30 Days",price:800,size:"2GB"}
  ]
};

let currentUser = null;
let currentUserData = null;
let pendingAction = null;
let allTransactions = [];

// ============================================
// AUTH STATE ‚Äî Runs on every page load
// ============================================
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // User is logged in ‚Äî load their data
    currentUser = user;
    await loadUserData(user.uid);
    showApp();
  } else {
    // Not logged in ‚Äî show login screen
    showLoginScreen();
  }
});

// ============================================
// REGISTER
// ============================================
window.registerUser = async function() {
  const name = document.getElementById("regName").value.trim();
  const phone = document.getElementById("regPhone").value.trim();
  const email = document.getElementById("regEmail").value.trim();
  const password = document.getElementById("regPassword").value;
  const refCode = document.getElementById("regReferral").value.trim().toUpperCase();
  const errEl = document.getElementById("regError");

  errEl.classList.remove("show");
  if (!name || !phone || !email || !password) return showAuthError("regError","Fill all required fields");
  if (password.length < 6) return showAuthError("regError","Password must be at least 6 characters");
  if (phone.length < 10) return showAuthError("regError","Enter a valid phone number");

  const btn = document.getElementById("regBtn");
  btn.disabled = true; btn.textContent = "Creating account...";

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    const uid = cred.user.uid;
    const userRefCode = (name.slice(0,3) + Math.floor(1000+Math.random()*9000)).toUpperCase();

    const userData = {
      uid, name, phone, email,
      balance: 0,
      pin: "0000",
      refCode: userRefCode,
      referredBy: refCode || null,
      referralCount: 0,
      referralEarned: 0,
      createdAt: serverTimestamp()
    };

    await setDoc(doc(db, "users", uid), userData);

    // Handle referral
    if (refCode) {
      const refQuery = query(collection(db, "users"), where("refCode","==",refCode));
      const refSnap = await getDocs(refQuery);
      if (!refSnap.empty) {
        const referrerDoc = refSnap.docs[0];
        const referrerId = referrerDoc.id;
        const referrerData = referrerDoc.data();
        await updateDoc(doc(db,"users",referrerId), {
          balance: (referrerData.balance || 0) + CONFIG.referralBonus,
          referralCount: (referrerData.referralCount || 0) + 1,
          referralEarned: (referrerData.referralEarned || 0) + CONFIG.referralBonus
        });
        await addDoc(collection(db,"transactions"), {
          userId: referrerId,
          type:"fund", title:"Referral Bonus",
          subtitle:`${name} joined using your code`,
          amount: CONFIG.referralBonus,
          direction:"credit", status:"success",
          createdAt: serverTimestamp()
        });
      }
    }

    showToast("Account created! Welcome to Eraaj-Data üéâ","success");
  } catch(e) {
    btn.disabled=false; btn.innerHTML='<i class="fa fa-user-plus"></i> Create Account';
    const msg = e.code==="auth/email-already-in-use" ? "Email already registered" :
                e.code==="auth/invalid-email" ? "Invalid email address" :
                e.code==="auth/weak-password" ? "Password too weak" : e.message;
    showAuthError("regError", msg);
  }
};

// ============================================
// LOGIN
// ============================================
window.loginUser = async function() {
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;

  if (!email || !password) return showAuthError("loginError","Enter email and password");

  const btn = document.getElementById("loginBtn");
  btn.disabled=true; btn.textContent="Logging in...";

  try {
    await signInWithEmailAndPassword(auth, email, password);
    // onAuthStateChanged handles the rest
  } catch(e) {
    btn.disabled=false; btn.innerHTML='<i class="fa fa-sign-in-alt"></i> Login';
    const msg = e.code==="auth/user-not-found" ? "No account found with this email" :
                e.code==="auth/wrong-password" ? "Incorrect password" :
                e.code==="auth/invalid-email" ? "Invalid email address" :
                e.code==="auth/too-many-requests" ? "Too many attempts. Try again later" : e.message;
    showAuthError("loginError", msg);
  }
};

// ============================================
// LOGOUT
// ============================================
window.logout = async function() {
  if (!confirm("Logout?")) return;
  await signOut(auth);
};

// ============================================
// FORGOT PASSWORD
// ============================================
window.forgotPassword = async function() {
  const email = document.getElementById("loginEmail").value.trim();
  if (!email) return showToast("Enter your email first","error");
  try {
    await sendPasswordResetEmail(auth, email);
    showToast("Reset email sent! Check your inbox","success");
  } catch(e) {
    showToast("Email not found","error");
  }
};

// ============================================
// LOAD USER DATA FROM FIRESTORE
// ============================================
async function loadUserData(uid) {
  try {
    const snap = await getDoc(doc(db,"users",uid));
    if (snap.exists()) {
      currentUserData = snap.data();
    } else {
      currentUserData = {name:"User",balance:0,pin:"0000",refCode:"----",referralCount:0,referralEarned:0};
    }
  } catch(e) {
    console.error("Load user error:", e);
    currentUserData = {name:"User",balance:0,pin:"0000",refCode:"----",referralCount:0,referralEarned:0};
  }
}

// ============================================
// SHOW APP / LOGIN
// ============================================
function showApp() {
  document.getElementById("splashScreen").classList.add("hidden");
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainApp").classList.remove("hidden");
  populateUI();
  loadTransactions();
  loadNoticeBanner();
  checkIfAdmin();
  if (localStorage.getItem("eraaj_dark")==="true") enableDark();
}

function showLoginScreen() {
  document.getElementById("splashScreen").classList.add("hidden");
  document.getElementById("mainApp").classList.add("hidden");
  document.getElementById("loginScreen").classList.remove("hidden");
  if (localStorage.getItem("eraaj_dark")==="true") enableDark();
}

function populateUI() {
  const d = currentUserData;
  const first = (d.name || "User").split(" ")[0];
  const init = first[0].toUpperCase();
  document.getElementById("userName").textContent = first;
  document.getElementById("userId").textContent = currentUser.uid.slice(0,10);
  document.getElementById("userAvatar").textContent = init;
  document.getElementById("acctName").textContent = first;
  document.getElementById("profileName").textContent = d.name || "User";
  document.getElementById("profileEmail").textContent = currentUser.email;
  document.getElementById("profileId").textContent = currentUser.uid.slice(0,10);
  document.getElementById("profileAvatar").textContent = init;
  document.getElementById("myRefCode").textContent = d.refCode || "----";
  document.getElementById("refCount").textContent = d.referralCount || 0;
  document.getElementById("refEarned").textContent = d.referralEarned || 0;
  updateBalanceDisplay();
}

function updateBalanceDisplay() {
  const bal = formatAmount(currentUserData.balance || 0);
  document.getElementById("balanceDisplay").textContent = bal;
  document.getElementById("walletBalDisplay").textContent = bal;
}

// ============================================
// BALANCE UPDATE
// ============================================
async function creditBalance(amount) {
  const newBal = (currentUserData.balance || 0) + amount;
  await updateDoc(doc(db,"users",currentUser.uid), {balance: newBal});
  currentUserData.balance = newBal;
  updateBalanceDisplay();
}

async function deductBalance(amount) {
  const newBal = (currentUserData.balance || 0) - amount;
  await updateDoc(doc(db,"users",currentUser.uid), {balance: newBal});
  currentUserData.balance = newBal;
  updateBalanceDisplay();
}

// ============================================
// TRANSACTIONS
// ============================================
async function addTransaction(tx) {
  await addDoc(collection(db,"transactions"), {
    userId: currentUser.uid,
    ...tx,
    createdAt: serverTimestamp()
  });
}

async function loadTransactions() {
  try {
    const q = query(
      collection(db,"transactions"),
      where("userId","==",currentUser.uid),
      orderBy("createdAt","desc")
    );
    const snap = await getDocs(q);
    allTransactions = snap.docs.map(d => ({id:d.id,...d.data()}));

    const recentEl = document.getElementById("recentTxList");
    if (allTransactions.length===0) {
      recentEl.innerHTML='<div class="tx-empty">No transactions yet</div>';
    } else {
      recentEl.innerHTML = allTransactions.slice(0,5).map(renderTx).join("");
    }
  } catch(e) {
    console.error("Tx error:",e);
    document.getElementById("recentTxList").innerHTML='<div class="tx-empty">Could not load transactions</div>';
  }
}

function renderAllTransactions(filter="all") {
  const list = filter==="all" ? allTransactions : allTransactions.filter(t=>t.type===filter);
  const el = document.getElementById("allTxList");
  el.innerHTML = list.length===0 ? '<div class="tx-empty">No transactions found</div>' : list.map(renderTx).join("");
}

function renderFundingHistory() {
  const list = allTransactions.filter(t=>t.type==="fund");
  const el = document.getElementById("fundingHistory");
  el.innerHTML = list.length===0 ? '<div class="tx-empty">No funding records yet</div>' : list.map(renderTx).join("");
}

function renderTx(tx) {
  const icons={data:"fa-wifi",airtime:"fa-phone",electricity:"fa-bolt",fund:"fa-plus-circle",cable:"fa-tv"};
  const icon = icons[tx.type]||"fa-circle";
  const amtClass = tx.direction==="credit"?"credit":"debit";
  const sign = tx.direction==="credit"?"+":"-";
  let date = "Just now";
  if (tx.createdAt && tx.createdAt.toDate) {
    date = tx.createdAt.toDate().toLocaleDateString("en-NG",{day:"numeric",month:"short",year:"numeric"});
  }
  return `<div class="tx-item">
    <div class="tx-icon ${tx.type}"><i class="fa ${icon}"></i></div>
    <div class="tx-details"><div class="tx-title">${tx.title}</div><div class="tx-sub">${tx.subtitle||""}</div></div>
    <div class="tx-right">
      <div class="tx-amount ${amtClass}">${sign}‚Ç¶${(tx.amount||0).toLocaleString()}</div>
      <div class="tx-date">${date}</div>
      <span class="tx-badge ${tx.status||'success'}">${tx.status||'success'}</span>
    </div>
  </div>`;
}

// ============================================
// SERVICES
// ============================================
window.showService = function(type) {
  const map={data:"dataModal",airtime:"airtimeModal",electricity:"electricityModal",cable:"electricityModal"};
  if(type==="data"){
    document.getElementById("dataNetwork").value="";
    document.getElementById("dataPhone").value="";
    document.getElementById("dataPlan").innerHTML='<option value="">-- Select Plan --</option>';
    document.getElementById("dataPriceBox").classList.add("hidden");
  }
  if(map[type]) document.getElementById(map[type]).classList.remove("hidden");
};

window.populatePlans = function() {
  const network = document.getElementById("dataNetwork").value;
  const sel = document.getElementById("dataPlan");
  sel.innerHTML='<option value="">-- Select Plan --</option>';
  document.getElementById("dataPriceBox").classList.add("hidden");
  if(network && DATA_PLANS[network]){
    DATA_PLANS[network].forEach(p=>{
      const o=document.createElement("option");
      o.value=p.id; o.textContent=`${p.name} ‚Äî ‚Ç¶${p.price}`;
      sel.appendChild(o);
    });
  }
};

window.updateDataPrice = function() {
  const network=document.getElementById("dataNetwork").value;
  const planId=document.getElementById("dataPlan").value;
  if(!network||!planId)return;
  const plan=DATA_PLANS[network].find(p=>p.id===planId);
  if(plan){
    document.getElementById("dataPriceDisplay").textContent=`‚Ç¶${plan.price}`;
    document.getElementById("dataPriceBox").classList.remove("hidden");
  }
};

window.buyData = function() {
  const network=document.getElementById("dataNetwork").value;
  const phone=document.getElementById("dataPhone").value.trim();
  const planId=document.getElementById("dataPlan").value;
  if(!network)return showToast("Select a network","error");
  if(!phone||phone.length<10)return showToast("Enter a valid phone number","error");
  if(!planId)return showToast("Select a data plan","error");
  const plan=DATA_PLANS[network].find(p=>p.id===planId);
  if(!plan)return showToast("Plan not found","error");
  if((currentUserData.balance||0)<plan.price)return showToast("Insufficient balance. Fund your wallet!","error");
  pendingAction={type:"data",network,phone,plan};
  closeModal("dataModal"); openPinModal();
};

window.buyAirtime = function() {
  const network=document.getElementById("airtimeNetwork").value;
  const phone=document.getElementById("airtimePhone").value.trim();
  const amount=parseInt(document.getElementById("airtimeAmount").value);
  if(!network)return showToast("Select a network","error");
  if(!phone||phone.length<10)return showToast("Enter a valid phone number","error");
  if(!amount||amount<CONFIG.minAirtime)return showToast(`Minimum airtime is ‚Ç¶${CONFIG.minAirtime}`,"error");
  if((currentUserData.balance||0)<amount)return showToast("Insufficient balance. Fund your wallet!","error");
  pendingAction={type:"airtime",network,phone,amount};
  closeModal("airtimeModal"); openPinModal();
};

window.payElectricity = function() {
  const disco=document.getElementById("elecDisco").value;
  const meter=document.getElementById("meterNumber").value.trim();
  const meterType=document.getElementById("meterType").value;
  const amount=parseInt(document.getElementById("elecAmount").value);
  if(!disco)return showToast("Select a Disco","error");
  if(!meter)return showToast("Enter meter number","error");
  if(!amount||amount<500)return showToast("Minimum is ‚Ç¶500","error");
  if((currentUserData.balance||0)<amount)return showToast("Insufficient balance. Fund your wallet!","error");
  pendingAction={type:"electricity",disco,meter,meterType,amount};
  closeModal("electricityModal"); openPinModal();
};

// ============================================
// PIN
// ============================================
function openPinModal() {
  document.querySelectorAll(".pin-box").forEach(b=>b.value="");
  document.getElementById("pinModal").classList.remove("hidden");
  setTimeout(()=>document.querySelectorAll(".pin-box")[0].focus(),300);
}

window.pinNext = function(input,pos) {
  if(input.value&&pos<4) document.querySelectorAll(".pin-box")[pos].focus();
};

window.confirmPin = async function() {
  const pin=Array.from(document.querySelectorAll(".pin-box")).map(b=>b.value).join("");
  if(pin.length<4)return showToast("Enter all 4 digits","error");
  if(pin!==currentUserData.pin)return showToast("Incorrect PIN","error");
  closeModal("pinModal");
  await processAction();
};

async function processAction() {
  if(!pendingAction)return;
  showLoading("Processing...");
  await new Promise(r=>setTimeout(r,1500)); // Simulate API call

  try {
    const{type}=pendingAction;

    if(type==="data"){
      const{network,phone,plan}=pendingAction;
      await deductBalance(plan.price);
      await addTransaction({type:"data",title:`${network} ${plan.size} Data`,subtitle:`To: ${phone}`,amount:plan.price,direction:"debit",status:"success"});
      hideLoading();
      showSuccess("Data Purchase Successful! üéâ",`${plan.size} sent to ${phone}`);
    }

    if(type==="airtime"){
      const{network,phone,amount}=pendingAction;
      await deductBalance(amount);
      await addTransaction({type:"airtime",title:`${network} Airtime`,subtitle:`To: ${phone}`,amount,direction:"debit",status:"success"});
      hideLoading();
      showSuccess("Airtime Purchase Successful! üì±",`‚Ç¶${amount} sent to ${phone}`);
    }

    if(type==="electricity"){
      const{disco,meter,amount}=pendingAction;
      const token=Array.from({length:4},()=>Math.floor(1000+Math.random()*9000)).join("-");
      await deductBalance(amount);
      await addTransaction({type:"electricity",title:`${disco} Electricity`,subtitle:`Meter: ${meter} | Token: ${token}`,amount,direction:"debit",status:"success"});
      hideLoading();
      showSuccess("Electricity Payment Successful! ‚ö°",`Token: ${token}\nMeter: ${meter}`);
    }

    pendingAction = null;
    await loadTransactions();
  } catch(e) {
    hideLoading();
    showToast("Transaction failed. Try again","error");
    console.error(e);
  }
}

// ============================================
// FUND WALLET ‚Äî PAYSTACK
// ============================================
window.showFundWallet = function() {
  document.getElementById("fundAmount").value="";
  document.getElementById("fundModal").classList.remove("hidden");
};

window.setAmount = function(a){document.getElementById("fundAmount").value=a;};
window.setAirtimeAmt = function(a){document.getElementById("airtimeAmount").value=a;};

window.initiatePaystack = async function() {
  const amount=parseInt(document.getElementById("fundAmount").value);
  if(!amount||amount<CONFIG.minFund)return showToast(`Minimum is ‚Ç¶${CONFIG.minFund}`,"error");
  closeModal("fundModal");

  if(CONFIG.paystackKey==="pk_test_YOUR_PAYSTACK_KEY"){
    await creditBalance(amount);
    await addTransaction({type:"fund",title:"Wallet Funding (Demo)",subtitle:"Demo mode ‚Äî add your Paystack key for real payments",amount,direction:"credit",status:"success"});
    await loadTransactions();
    showSuccess("Demo Wallet Funded! üí∞",`‚Ç¶${amount.toLocaleString()} added (demo mode)`);
    return;
  }

  try {
    const handler = PaystackPop.setup({
      key: CONFIG.paystackKey,
      email: currentUser.email,
      amount: amount*100,
      currency: "NGN",
      ref: "ERJ-"+Date.now(),
      callback: async function(res) {
        await creditBalance(amount);
        await addTransaction({type:"fund",title:"Wallet Funding",subtitle:`Ref: ${res.reference}`,amount,direction:"credit",status:"success"});
        await loadTransactions();
        showSuccess("Wallet Funded! üí∞",`‚Ç¶${amount.toLocaleString()} added to your wallet`);
      },
      onClose: function(){showToast("Payment cancelled","error");}
    });
    handler.openIframe();
  } catch(e) {
    showToast("Payment error. Try again","error");
  }
};

// ============================================
// PAGE NAV
// ============================================
window.showPage = function(pageId,btn) {
  document.querySelectorAll(".page").forEach(p=>{p.classList.add("hidden");});
  document.getElementById(pageId).classList.remove("hidden");
  if(btn){document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));btn.classList.add("active");}
  if(pageId==="transPage")renderAllTransactions();
  if(pageId==="walletPage")renderFundingHistory();
};

window.filterTx = function(type,btn) {
  document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active"); renderAllTransactions(type);
};

// ============================================
// DARK MODE
// ============================================
window.toggleDarkMode = function() {
  const dark=document.body.classList.toggle("dark-mode");
  document.getElementById("darkIcon").className=dark?"fa fa-sun":"fa fa-moon";
  localStorage.setItem("eraaj_dark",dark.toString());
};
function enableDark(){
  document.body.classList.add("dark-mode");
  const i=document.getElementById("darkIcon");if(i)i.className="fa fa-sun";
}

// ============================================
// REFERRAL
// ============================================
window.showReferral = function() {
  const s=document.getElementById("referralSection");
  s.classList.toggle("hidden");
};

window.copyRefCode = function() {
  const code=currentUserData.refCode||"----";
  navigator.clipboard.writeText(code)
    .then(()=>showToast("Referral code copied! üéâ","success"))
    .catch(()=>showToast("Your code: "+code));
};

// ============================================
// CHANGE PIN
// ============================================
window.showChangePin = async function() {
  const p=prompt("Enter new 4-digit PIN:");
  if(!p||p.length!==4||isNaN(p))return showToast("PIN must be exactly 4 digits","error");
  try {
    await updateDoc(doc(db,"users",currentUser.uid),{pin:p});
    currentUserData.pin=p;
    showToast("PIN updated successfully!","success");
  } catch(e) {
    showToast("Failed to update PIN","error");
  }
};

// ============================================
// MODALS & UI
// ============================================
window.closeModal = function(id){document.getElementById(id).classList.add("hidden");};

document.addEventListener("click",e=>{
  if(e.target.classList.contains("modal-overlay")) e.target.classList.add("hidden");
});

function showSuccess(title,msg){
  document.getElementById("successTitle").textContent=title;
  document.getElementById("successMsg").textContent=msg;
  document.getElementById("successModal").classList.remove("hidden");
}

let toastTimer;
window.showToast = function(msg,type=""){
  clearTimeout(toastTimer);
  const t=document.getElementById("toast");
  t.textContent=msg; t.className=`toast ${type}`;
  toastTimer=setTimeout(()=>t.classList.add("hidden"),3500);
};

function showLoading(msg="Loading..."){
  const d=document.createElement("div");
  d.className="loading-overlay";d.id="loadingOverlay";
  d.innerHTML=`<div class="spinner"></div><p>${msg}</p>`;
  document.body.appendChild(d);
}
function hideLoading(){const e=document.getElementById("loadingOverlay");if(e)e.remove();}

window.showTab = function(t){
  document.getElementById("loginForm").classList.toggle("hidden",t!=="login");
  document.getElementById("registerForm").classList.toggle("hidden",t!=="register");
  document.querySelectorAll(".tab-btn").forEach((b,i)=>b.classList.toggle("active",(i===0&&t==="login")||(i===1&&t==="register")));
  document.getElementById("loginError").classList.remove("show");
  document.getElementById("regError").classList.remove("show");
};

window.togglePw = function(id){const i=document.getElementById(id);i.type=i.type==="password"?"text":"password";};

function showAuthError(id,msg){
  const el=document.getElementById(id);
  el.textContent=msg; el.classList.add("show");
  const btn=id==="loginError"?document.getElementById("loginBtn"):document.getElementById("regBtn");
  if(btn){btn.disabled=false;btn.innerHTML=id==="loginError"?'<i class="fa fa-sign-in-alt"></i> Login':'<i class="fa fa-user-plus"></i Create Account';}
}

function formatAmount(a){
  return Number(a).toLocaleString("en-NG",{minimumFractionDigits:2,maximumFractionDigits:2});
}

// ============================================
// ADMIN & NOTICE SYSTEM ‚Äî Eraaj-Data
// ============================================
const ADMIN_PASSWORD = "Eraaj@Admin2024";
const ADMIN_EMAILS = ["lamidosadiq6@gmail.com"];
let selectedNoticeType = "info";

function checkIfAdmin() {
  if (currentUser && ADMIN_EMAILS.includes(currentUser.email)) {
    const btn = document.getElementById("adminNavBtn");
    if (btn) btn.style.display = "flex";
  }
}

window.checkAdminPw = function() {
  const pw = document.getElementById("adminPwInput").value;
  if (pw === ADMIN_PASSWORD) {
    document.getElementById("adminLock").classList.add("hidden");
    document.getElementById("adminPanel").classList.remove("hidden");
    loadAdminStats();
    loadAdminNotices();
  } else {
    showToast("Incorrect admin password", "error");
    document.getElementById("adminPwInput").value = "";
  }
};

window.selectType = function(type, btn) {
  selectedNoticeType = type;
  document.querySelectorAll(".type-btn").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");
};

window.postNotice = async function() {
  const title = document.getElementById("noticeTitle").value.trim();
  const msg = document.getElementById("noticeMsg").value.trim();
  if (!title) return showToast("Enter a notice title","error");
  if (!msg) return showToast("Enter a notice message","error");
  try {
    showLoading("Posting notice...");
    await addDoc(collection(db,"notices"),{
      title, message:msg, type:selectedNoticeType,
      active:true, createdBy:currentUser.uid,
      createdAt:serverTimestamp()
    });
    hideLoading();
    document.getElementById("noticeTitle").value = "";
    document.getElementById("noticeMsg").value = "";
    showToast("Notice posted to all users! üì¢","success");
    loadAdminNotices();
    loadNoticeBanner();
  } catch(e){ hideLoading(); showToast("Failed to post notice","error"); }
};

window.deleteNotice = async function(id) {
  if (!confirm("Delete this notice?")) return;
  try {
    const {deleteDoc,doc:fsDoc} = await import("https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js");
    await deleteDoc(fsDoc(db,"notices",id));
    showToast("Notice deleted","success");
    loadAdminNotices(); loadNoticeBanner();
  } catch(e){ showToast("Failed to delete","error"); }
};

async function loadAdminNotices() {
  try {
    const q = query(collection(db,"notices"),orderBy("createdAt","desc"));
    const snap = await getDocs(q);
    const el = document.getElementById("adminNoticeList");
    if (!el) return;
    document.getElementById("statNotices").textContent = snap.size;
    if (snap.empty){ el.innerHTML='<div class="tx-empty">No notices yet</div>'; return; }
    el.innerHTML = snap.docs.map(d => {
      const n = d.data();
      return `<div class="existing-notice">
        <div class="existing-notice-text">
          <span class="existing-notice-badge ${n.type}">${n.type.toUpperCase()}</span>
          <div style="font-weight:600;font-size:13px;margin-top:4px">${n.title}</div>
          <div style="font-size:12px;color:var(--text-light);margin-top:2px">${n.message}</div>
        </div>
        <button class="delete-notice-btn" onclick="deleteNotice('${d.id}')"><i class="fa fa-trash"></i></button>
      </div>`;
    }).join("");
  } catch(e){ console.error(e); }
}

async function loadNoticeBanner() {
  try {
    const q = query(collection(db,"notices"),orderBy("createdAt","desc"));
    const snap = await getDocs(q);
    const banner = document.getElementById("noticeBanner");
    if (!banner){ return; }
    if (snap.empty){ banner.innerHTML=""; return; }
    const dismissed = JSON.parse(localStorage.getItem("dismissed_notices")||"[]");
    const icons = {info:"fa-info-circle",warning:"fa-exclamation-triangle",success:"fa-check-circle",danger:"fa-exclamation-circle"};
    const active = snap.docs.filter(d => !dismissed.includes(d.id));
    banner.innerHTML = active.slice(0,3).map(d => {
      const n = d.data();
      const icon = icons[n.type]||"fa-info-circle";
      let timeStr = "Just now";
      if(n.createdAt&&n.createdAt.toDate) timeStr=n.createdAt.toDate().toLocaleDateString("en-NG",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"});
      return `<div class="notice-item ${n.type}" id="notice-${d.id}">
        <i class="fa ${icon} notice-icon"></i>
        <div class="notice-content">
          <div class="notice-title">${n.title}</div>
          <div class="notice-msg">${n.message}</div>
          <div class="notice-time">üïê ${timeStr}</div>
        </div>
        <button class="notice-close" onclick="dismissNotice('${d.id}')">‚úï</button>
      </div>`;
    }).join("");
  } catch(e){ console.error(e); }
}

window.dismissNotice = function(id) {
  const el = document.getElementById("notice-"+id);
  if(el){ el.style.opacity="0"; el.style.transform="translateX(100%)"; el.style.transition="all 0.3s ease"; setTimeout(()=>el.remove(),300); }
  const d = JSON.parse(localStorage.getItem("dismissed_notices")||"[]");
  d.push(id); localStorage.setItem("dismissed_notices",JSON.stringify(d));
};

async function loadAdminStats() {
  try {
    const txSnap = await getDocs(collection(db,"transactions"));
    document.getElementById("statTx").textContent = txSnap.size;
    let revenue = 0;
    txSnap.docs.forEach(d=>{ const t=d.data(); if(t.type==="fund"&&t.direction==="credit") revenue+=(t.amount||0); });
    document.getElementById("statRevenue").textContent = "‚Ç¶"+revenue.toLocaleString();
    const nSnap = await getDocs(collection(db,"notices"));
    document.getElementById("statNotices").textContent = nSnap.size;
    document.getElementById("statUsers").textContent = "üü¢ Live";
  } catch(e){ console.error(e); }
}

</script>
<script src="https://js.paystack.co/v1/inline.js"></script>
</body>
</html>